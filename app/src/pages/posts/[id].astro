---
import Layout from '../../layouts/Layout.astro';
import ArticleHeader from '../../components/ArticleHeader.astro';
import ArticleContent from '../../components/ArticleContent.astro';
import RelatedPosts from '../../components/RelatedPosts.astro';
import { getArticles, getArticle, type Article } from '../../lib/microcms';
import { formatDate } from '../../utils/dateFormatter';

// 静的生成用のパスを生成
export async function getStaticPaths() {
  const articles = await getArticles();
  return articles.map((article) => ({
    params: { id: article.id },
  }));
}

const { id } = Astro.params;
const article = await getArticle(id);

if (!article) {
  return Astro.redirect('/404');
}
---

<Layout title={article.title}>
  <div class="breadcrumb">
    <a href="/">Home</a>
    <span> / </span>
    <a href="/">Posts</a>
    <span> / </span>
    <span>{article.title}</span>
  </div>


  <ArticleHeader 
    title={article.title}
    image={article.image?.url || ''}
    date={`作成日: ${formatDate(article.createdAt)}`}
    category={article.category?.name || ''}
    tag={article.tag || ''}
  />

  {article.updatedAt && article.updatedAt !== article.createdAt && (
    <div style="margin-bottom:1.5rem; color:#666; font-size:0.95rem; font-family:'Courier New',monospace;">
      最終更新日: {formatDate(article.updatedAt)}
    </div>
  )}

  <ArticleContent content={article.content} />
</Layout>

<style>
  .breadcrumb {
    margin: 1.5rem 0;
    font-size: 0.9rem;
    color: #666;
    font-family: 'Courier New', monospace;
  }

  .breadcrumb a {
    color: #0066cc;
    text-decoration: none;
    border-bottom: 2px dotted currentColor;
  }

  .breadcrumb a:hover {
    background: #ffff00;
    color: #000;
  }

  .breadcrumb span {
    margin: 0 0.5rem;
  }
</style>
