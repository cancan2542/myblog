---
import Layout from '../layouts/Layout.astro';

type BlogItem = {
  id: string;
  title: string;
  body: string;
};

const API_URL = import.meta.env.MICROCMS_API_URL;
const API_KEY = import.meta.env.MICROCMS_API_KEY;

let data: { contents: BlogItem[] } = { contents: [] };
let error = '';

try {
  const res = await fetch(API_URL, {
    headers: { 'X-API-KEY': API_KEY }
  });
  if (!res.ok) {
    error = `APIエラー: ${res.status} ${res.statusText}`;
  } else {
    data = await res.json();
  }
} catch (e) {
  const err = e as Error;
  error = `通信エラー: ${err.message}`;
}
---

<Layout>
  <div style="margin: 2rem;">
    <h2>記事一覧</h2>
    {error
      ? <p style="color:red">{error}</p>
      : (
        <ul>
          {data.contents.map((item) => (
            <li>
              <a href={`/${item.id}`}><strong>{item.title}</strong></a>
            </li>
          ))}
        </ul>
      )
    }
  </div>
</Layout>
