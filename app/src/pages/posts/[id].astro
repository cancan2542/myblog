---
import Layout from '../../layouts/Layout.astro';
import ArticleHeader from '../../components/ArticleHeader.astro';
import ArticleContent from '../../components/ArticleContent.astro';
import RelatedPosts from '../../components/RelatedPosts.astro';
import { getArticles, getArticle, type Article } from '../../lib/microcms';

// 静的生成用のパスを生成
export async function getStaticPaths() {
  const articles = await getArticles();
  return articles.map((article) => ({
    params: { id: article.id },
  }));
}

const { id } = Astro.params;
const article = await getArticle(id);

if (!article) {
  return Astro.redirect('/404');
}

// 日付フォーマット
const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  return date.toLocaleDateString('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\//g, '.');
};
---

<Layout title={article.title}>
  <div class="breadcrumb">
    <a href="/">Home</a>
    <span> / </span>
    <a href="/">Posts</a>
    <span> / </span>
    <span>{article.title}</span>
  </div>

  <ArticleHeader 
    title={article.title}
    image={article.image?.url || ''}
    date={formatDate(article.publishedAt || article.createdAt)}
    category={article.category?.name || ''}
    tag={article.tag || ''}
  />

  <ArticleContent content={article.content} />
</Layout>

<style>
  .breadcrumb {
    margin: 1.5rem 0;
    font-size: 0.9rem;
    color: #666;
    font-family: 'Courier New', monospace;
  }

  .breadcrumb a {
    color: #0066cc;
    text-decoration: none;
    border-bottom: 2px dotted currentColor;
  }

  .breadcrumb a:hover {
    background: #ffff00;
    color: #000;
  }

  .breadcrumb span {
    margin: 0 0.5rem;
  }
</style>
