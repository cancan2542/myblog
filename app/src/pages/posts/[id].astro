---
import Layout from '../../layouts/Layout.astro';
import ArticleHeader from '../../components/ArticleHeader.astro';
import ArticleContent from '../../components/ArticleContent.astro';
import RelatedPosts from '../../components/RelatedPosts.astro';
import { getAllPostIds, getPostById, getRelatedPosts } from '../../data/posts';

// 静的生成用のパスを生成
export async function getStaticPaths() {
  const postIds = getAllPostIds();
  return postIds.map((id) => ({
    params: { id },
  }));
}

const { id } = Astro.params;
const post = getPostById(id);
const relatedPosts = getRelatedPosts(id);

if (!post) {
  return Astro.redirect('/404');
}
---

<Layout title={post.title}>
  <div class="breadcrumb">
    <a href="/">Home</a>
    <span> / </span>
    <a href="/">Posts</a>
    <span> / </span>
    <span>{post.title}</span>
  </div>

  <ArticleHeader 
    title={post.title}
    image={post.image}
    date={post.date}
    category={post.category}
    tag={post.tag}
  />

  <ArticleContent content={post.content} />

  {relatedPosts.length > 0 && (
    <RelatedPosts posts={relatedPosts} />
  )}
</Layout>

<style>
  .breadcrumb {
    margin: 1.5rem 0;
    font-size: 0.9rem;
    color: #666;
    font-family: 'Courier New', monospace;
  }

  .breadcrumb a {
    color: #0066cc;
    text-decoration: none;
    border-bottom: 2px dotted currentColor;
  }

  .breadcrumb a:hover {
    background: #ffff00;
    color: #000;
  }

  .breadcrumb span {
    margin: 0 0.5rem;
  }
</style>
